{
  "hash": "dc2aad5096f7fe7887d4101f5e13cde2",
  "result": {
    "engine": "jupyter",
    "markdown": "---\ntitle: History of NYSE ME\nsubtitle: \"Market Capitalization Concentration in the NYSE\"\n---\n\n\nThe NYSE continues to exhibit substantial market capitalization concentration. Since 2010 — and more sharply since 2016 — the very largest firms have distanced themselves even from the rest of the top 5%, highlighting the structural importance of tail dynamics in financial markets. Any realistic asset pricing model must account for this persistent and extreme upper-tail asymmetry.\n\n::: {#eb82237a .cell execution_count=1}\n``` {.python .cell-code}\nimport pandas as pd\nimport pandas_datareader.data as pdr\nimport warnings\nwarnings.simplefilter(action='ignore', category=FutureWarning) # FutureWarning 제거\n\nimport matplotlib.pyplot as plt\nimport matplotlib.dates as mdates\n\n# Define time period\nstart_date = \"1996-01-01\"\nend_date = \"2024-12-31\"\n\n# Fetch Fama-French ME_Breakpoints data (NYSE percentile breakpoints)\nbreakpoints_raw = pdr.DataReader(\n    name=\"ME_Breakpoints\",\n    data_source=\"famafrench\",\n    start=start_date,\n    end=end_date\n)[0]\n\n# Extract percentile labels from column names (e.g., \"(0, 5)\" -> \"5\")\ndef extract_upper_bound(label):\n    if isinstance(label, str) and \"(\" in label:\n        try:\n            return str(int(label.split(\",\")[1].replace(\")\", \"\").strip()))\n        except Exception:\n            return label\n    elif isinstance(label, tuple):\n        return str(label[1])\n    return str(label)\n\n# Rename columns to only use upper percentile values\ncolumns_to_rename = {col: extract_upper_bound(col) for col in breakpoints_raw.columns if col != 'Count'}\nbreakpoints = breakpoints_raw.rename(columns=columns_to_rename)\n\n# Normalize ME values by number of firms (Count) to get \"per firm\" values\nfor col in breakpoints.columns:\n    if col != 'Count':\n        breakpoints[col] = breakpoints[col] / breakpoints['Count']\n\n# Print average firm count over the period\navg_count = int(breakpoints['Count'].mean())\nprint(f\"Average number of NYSE firms from {start_date} to {end_date}: {avg_count}\")\n```\n\n::: {.cell-output .cell-output-stdout}\n```\nAverage number of NYSE firms from 1996-01-01 to 2024-12-31: 1386\n```\n:::\n:::\n\n\n## NYSE Market Equity Breakpoints: Long-Term Dynamics\n\nThe Fama-French dataset `ME_Breakpoints` provides monthly percentile breakpoints for market equity (ME), computed only from NYSE stocks. These breakpoints span from the 5th to the 100th percentile and are calculated based on market capitalization (price times shares outstanding, in millions of USD) at month-end. Importantly, closed-end funds and REITs are excluded, and only firms with CRSP share codes 10 or 11 and valid price/share data are included.\n\nThis file investigates the evolution of market concentration in the NYSE based on these ME breakpoints, emphasizing the dynamics in the upper tail of the distribution, particularly the top 5% of firms.\n\n\n## Breakpoint Time Series per Firm (1996–2024)\n\nWe plot the NYSE ME breakpoints divided by the number of firms each month (\"per firm\") from 1996 to 2024. The results reveal two distinct phases:\n\n- **Pre-2010:** A cyclical pattern dominates, consistent with broader economic expansions and contractions. For instance, the 2000–2001 tech bubble and the 2008 global financial crisis exhibit clear signals of expansion and collapse.\n- **Post-2010:** A structural break is visible. Especially since 2016, the average ME per firm in the top percentile (100%) exhibits a sharp and persistent upward trend.\n\nThis long-term trend implies a sustained capital lock-in within a small number of mega-cap firms, increasingly distanced from the rest of the NYSE universe.\n\n::: {#64813200 .cell execution_count=2}\n``` {.python .cell-code}\n# Plot selected percentile breakpoints over time\nselected_percentiles = ['80', '85', '90', '95', '100']\nbreakpoints[selected_percentiles].plot(figsize=(10, 5))\n\nplt.legend(title='Percentile')\nplt.ylabel('Market Equity (in millions) per firm')\nplt.title('NYSE ME Breakpoints (Per Firm Basis)')\nplt.tight_layout()\nplt.show()\n```\n\n::: {.cell-output .cell-output-display}\n![](03_history_nyse_files/figure-html/cell-3-output-1.png){}\n:::\n:::\n\n\n## Cross-Sectional Concentration at the Tail\n\nTo better understand the shape of the right tail, we visualize the percentile distribution at the most recent observation (2024-12). The result is striking: while the ME per firm grows gradually between percentiles 5 to 95, a dramatic jump occurs at the 100th percentile.\n\nThis highlights that **the concentration of market value within the top 5% is extreme**, and the very last percentile alone contains firms with ME per firm often an order of magnitude greater than those in the 95th percentile.\n\n::: {#dc77b59f .cell execution_count=3}\n``` {.python .cell-code}\ndef plot_breakpoints_at_end(df, count_col='Count', start_pct=0, end_pct=None, title_suffix=''):\n    \"\"\"\n    Plot breakpoints at the last available date.\n    \n    Parameters:\n        df: DataFrame with percentile columns and 'Count'\n        count_col: name of the column representing number of firms (default: 'Count')\n        start_pct: starting index for column slice (e.g., -20 for top 20 percentiles)\n        end_pct: ending index for column slice (default: None means till the end)\n        title_suffix: string appended to plot title\n    \"\"\"\n    # Select data at last date\n    last_row = df.tail(1).drop(columns=[count_col])\n    \n    # Slice desired percentile columns\n    selected_columns = last_row.columns[start_pct:end_pct]\n    y_data = pd.to_numeric(last_row[selected_columns].values.flatten(), errors='coerce')\n    \n    # Plot\n    plt.figure(figsize=(8, 4))\n    plt.plot(selected_columns, y_data, marker='o')\n    plt.xticks(rotation=45, ha='right')\n    plt.xlabel('Percentile')\n    plt.ylabel('ME Breakpoints (in millions per firm)')\n    plt.title(f'NYSE ME Breakpoints at {df.index[-1]} {title_suffix}')\n    plt.tight_layout()\n    plt.grid(True)\n    plt.show()\n\n# 전체 percentile 구간 시각화\nplot_breakpoints_at_end(breakpoints, start_pct=0, title_suffix='(Full Range)')\n\n# 상위 3개 빼고 시각화 (5~90)\nplot_breakpoints_at_end(breakpoints, start_pct=-20, end_pct=-2, title_suffix='(upto Top 20 Percentiles)')\n\n# 가장 극단적인 상위 3개만 (90, 95, 100 만)\nplot_breakpoints_at_end(breakpoints, start_pct=-3, title_suffix='(Top 3 Percentiles)')\n```\n\n::: {.cell-output .cell-output-display}\n![](03_history_nyse_files/figure-html/cell-4-output-1.png){}\n:::\n\n::: {.cell-output .cell-output-display}\n![](03_history_nyse_files/figure-html/cell-4-output-2.png){}\n:::\n\n::: {.cell-output .cell-output-display}\n![](03_history_nyse_files/figure-html/cell-4-output-3.png){}\n:::\n:::\n\n\n## Time Series of the Tail Ratio: 100th / 95th Percentile\n\nTo quantify tail concentration dynamics over time, we construct a monthly time series of the ME per firm ratio between the 100th and 95th percentiles. This ratio serves as a tail index for how dominant the very largest firms are, even among the elite.\n\nThe time series reveals the following:\n\n- **1996–2001:** Rapid escalation during the dot-com boom, with the ratio peaking above 20.\n- **2003–2008:** Stabilization around ~13.\n- **2009:** A brief post-crisis surge back above 18.\n- **2010–2016:** A sharp decline and plateau near 7, indicating relative equality among top-tier firms.\n- **Post-2016:** A gradual resurgence in the ratio, reflecting renewed concentration at the very top.\n\n::: {#fcb94f2a .cell execution_count=4}\n``` {.python .cell-code}\n# Calculate the ME per firm ratio: 100th / 95th percentile\nratio_series = breakpoints['100'] / breakpoints['95']\n\n# Convert PeriodIndex to DatetimeIndex for plotting\nratio_series.index = ratio_series.index.to_timestamp()\n\n# Plot both raw and log-transformed ratio\nplt.figure(figsize=(12, 5))\n\nax = plt.gca()\nax.xaxis.set_major_locator(mdates.YearLocator(2))\nax.xaxis.set_major_formatter(mdates.DateFormatter('%Y'))\nax.tick_params(axis='x', rotation=45) # x축 눈금 회전 추가\n\n# Raw ratio\nplt.plot(ratio_series.index, ratio_series, marker='o')\nplt.title('ME per Firm Ratio: 100th / 95th Percentile')\nplt.xlabel('Date')\nplt.ylabel('Ratio (ME[100] / ME[95])')\nplt.grid(True)\n\nplt.tight_layout()\nplt.show()\n```\n\n::: {.cell-output .cell-output-display}\n![](03_history_nyse_files/figure-html/cell-5-output-1.png){}\n:::\n:::\n\n\n::: {#e95909b0 .cell execution_count=5}\n``` {.python .cell-code}\n# Calculate the ME per firm ratio: 95th / 50th percentile\nratio_series = breakpoints['95'] / breakpoints['50']\n\n# Convert PeriodIndex to DatetimeIndex for plotting\nratio_series.index = ratio_series.index.to_timestamp()\n\n# Plot both raw and log-transformed ratio\nplt.figure(figsize=(12, 5))\n\n# Raw ratio\nplt.plot(ratio_series.index, ratio_series, marker='o')\nplt.title('ME per Firm Ratio: 95th / 50th Percentile')\nplt.xlabel('Date')\nplt.ylabel('Ratio (ME[95] / ME[50])')\nplt.grid(True)\n\nplt.tight_layout()\nplt.show()\n```\n\n::: {.cell-output .cell-output-display}\n![](03_history_nyse_files/figure-html/cell-6-output-1.png){}\n:::\n:::\n\n\n## Broader Context: NYSE and the Top 5%\n\nIt is critical to underscore that Fama-French breakpoints are calculated **using only NYSE stocks**. Despite the rise of Nasdaq dominance in recent decades, the NYSE remains the foundation for constructing breakpoints in academic asset pricing.\n\nThe breakpoints for:\n\n- **Market Equity (ME):** monthly, based on NYSE stocks with viable price and share data.\n- **Book-to-Market (BE/ME):** annually, using BE from t-1 and ME from December of t-1.\n- **Prior 2–12 month Return:** monthly, requiring CRSP price and return data.\n\nThese indicators, especially in the upper tail, are overwhelmingly driven by the top 5% of NYSE firms — roughly 60–70 firms. These companies exert outsized influence on asset pricing, portfolio construction, and market dynamics.\n\n",
    "supporting": [
      "03_history_nyse_files"
    ],
    "filters": [],
    "includes": {}
  }
}