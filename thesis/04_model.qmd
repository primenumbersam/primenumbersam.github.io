---
title: Model
date: '2025-03-26'
---

# Empirical Study: Structure and Strategy of the TBTF Portfolio

- **The TBTF Strategy**  
  - **Large vs. Small Stocks**: Analyze return distribution asymmetry and volatility differences over time.  
  - **Top 10 Stocks**: List membership (e.g., permno) and stability, dominated by high-tech (Nasdaq chips/software).  
  - **Top 10 Transition Analysis**: Transition matrix and stationary distribution (three states: top, mid, out).  
  - **TBTF Performance**: Compare risk-adjusted returns (Sharpe, Sortino, Omega) to market indices/ETFs.  

## The TBTF Strategy

- Large vs. Small Stocks: Analyze return distribution asymmetry and volatility differences between large-cap and small-cap stocks, especially across pre- and post-2010 periods.
- Top 10 Stocks: Examine composition (e.g., permno list), industry concentration (high-tech dominance), and historical persistence of top-10 market cap stocks.
- Top 10 Transition Analysis: Construct a transition matrix with three state categories (Top, Mid, Out) and estimate their long-run stationary distribution.
- TBTF Performance: Compare the risk-adjusted performance (Sharpe, Sortino, Omega) of the TBTF strategy to benchmark market indices and ETFs.

## I. Research Design Overview

1. **Objective**  
   To empirically test the performance of a TBTF-style portfolio (top market cap stocks) and identify structural shifts in market dynamics using 2010 as a potential structural break. The study examines capital concentration, lock-in persistence, and asymmetries in return distributions.

2. **Period Split**  
   - Pre-2010: 1996.01 – 2009.12  
   - Post-2010: 2010.01 – 2023.12  
   Monthly frequency, 14 years per subperiod.

3. **Main Hypotheses**
   - Are the return distributions of top market-cap stocks structurally superior in terms of risk-adjusted performance?
   - Do persistence and absorption into the top group distort market competitiveness?
   - Does the time-average capital share of top-ranked stocks show convexity (like a Lorenz curve)?

## II. Data Source and Construction

1. **Primary Data: CRSP Monthly Stock File**  
   - Universe: NYSE, Nasdaq, AMEX  
   - Variables: PERMNO, date, market cap, return (RET), SIC/industry, delisting return (DLRET)  
   - Filter: Common stocks only (share codes 10, 11)  

   Bias Adjustment Strategy:
   - Survivorship bias: Use full universe (include delisted assets)
   - Delisting return:  
     $$ R_{\text{net}} = (1 + \text{RET}) \cdot (1 + \text{DLRET}) - 1 $$
     - If RET is NaN and DLRET exists, use DLRET alone.
   - Many studies exclude NaNs—this introduces bias. Our approach incorporates all exits via adjustment.
   - For transition matrix estimation, define an 11th state:
     - Delisted assets → absorbing state (exit)
     - IPO assets → external state before joining proper decile group the following period

2. **Secondary Data: Fama-French Portfolios (Ken French Library)**  
   - ME10 decile portfolios for big/small return comparison  
   - ME × PRIOR (e.g., ME5 PRIOR4, ME4 PRIOR3) for value/momentum portfolios  
   - Returns are value-weighted, rebalanced annually, provided monthly

## III. Portfolio Construction Logic

The strategy is structured by the 5W1H decomposition framework:

- How: asset weighting scheme
- What: asset universe & selection rule
- When: signal window & rebalancing frequency

1. **What – Asset Selection**  
   - Criterion: market cap percentile rank  
   - Size of selection: n = 10 (base), also test n ∈ {5, 10, 20, 30, 50}  
   - At each time t, select top-n assets by market cap rank

2. **How – Asset Weighting**  
   - Functional form:  
     $$ \text{weight}_i = \alpha + \beta \cdot \text{rank}_i + \gamma \cdot \text{rank}_i^2 $$
     where rank is percentile-based (1 = largest)  
   - Dependent variable: market cap share of each asset  
   - Quadratic regression is conducted in-sample, separately by subperiod  
   - Rationale: capital concentration at the top grows convexly (akin to a Lorenz curve)

3. **When – Rebalancing Frequency**  
   - Fixed-interval rebalancing tested for:
     - Monthly (1M)
     - Quarterly (3M)
     - Semiannual (6M)
     - Annual (12M)
   - All portfolios are rebalanced at fixed calendar intervals (e.g., Jan, Apr, Jul, Oct)

## IV. Performance Evaluation

### Size Momentum: Size-sorted Portfolios

**Motivation**:  
To empirically validate whether large-cap portfolios structurally outperform small-cap portfolios in terms of risk-adjusted returns over the long run. The comparison uses FF size decile portfolios over a 60-year horizon.

**Methodology**:
- Use `s_10` (smallest decile) and `b_10` (largest decile) monthly returns from 1963–2023.
- Compare:
  - Return distributions
  - Standard deviations
  - Sharpe ratio dynamics (time-varying)

**Key Findings**:
- The `b_10` portfolio exhibits consistently lower volatility and higher average Sharpe ratios than `s_10`.
- Dynamic Sharpe ratio visualization reveals persistent structural advantage, not just in static summary statistics.
- The Sharpe ratio “curve” (rather than a static point) helps avoid misleading inference due to time-aggregation bias.

**Contribution**:
- Introduces a novel visualization framework (Sharpe-level curves) to study structural return asymmetries.
- Provides empirical justification for focusing on top-cap portfolios in the TBTF strategy.
- Complements the benchmark comparison with ETFs by offering deeper structural insight into return composition.

To validate the structural relevance of the TBTF strategy, we first examine the historical performance of size-sorted portfolios constructed by Fama and French. Specifically, we focus on the top and bottom deciles of market capitalization—commonly labeled as `b_10` (big) and `s_10` (small)—using monthly returns spanning July 1963 to June 2023. This comparison serves as a high-level contrast between large- and small-cap portfolios, establishing a foundational context for TBTF-style selection.

The data are sourced from the Ken French Data Library, specifically the “Portfolios Formed on Size (ME)” dataset, which reports monthly returns for portfolios rebalanced annually based on NYSE size breakpoints. These portfolios include stocks from NYSE, Nasdaq, and AMEX. We restrict our focus to the decile portfolios and construct additional aggregates (e.g., `s_70`, `s_90`) for robustness.

To compare performance across the two size groups, we analyze summary statistics (mean, standard deviation), distributional shapes (QQ-plots), and Sharpe ratios. While conventional academic studies often compare these portfolios via static scatter plots in mean–volatility space, we propose a dynamic visualization: **Sharpe ratio level curves** plotted over time.

This time-series view reveals a persistent Sharpe ratio advantage of `b_10` over `s_10`, which is not immediately obvious from static summaries. Figure 1 demonstrates this visually—each portfolio’s performance is not summarized by a single dot, but by an evolving path that captures time-varying return characteristics. This perspective helps mitigate the risk of time-aggregation bias and provides stronger evidence for the structural advantage of large-cap portfolios.

We find that the `b_10` portfolio not only exhibits lower volatility but also yields higher average Sharpe ratios over the 60-year horizon. This supports the hypothesis that large-cap portfolios, especially those at the very top, are inherently more stable and efficient return-generating vehicles. Such empirical patterns provide a compelling rationale for constructing TBTF portfolios using a top-market-cap selection rule.

1. **Return-based Metrics**  
   - Cumulative return  
   - Mean and standard deviation of monthly returns

2. **Risk-adjusted Metrics**  
   - Sharpe Ratio  
   - Sortino Ratio  
   - Omega Ratio  
   - Max Drawdown  
   - Calmar Ratio

3. **Distributional Properties**  
   - Skewness, Kurtosis  
   - Test for distributional differences (KS, Anderson-Darling) between:
     - TBTF vs. equal-weight top-n
     - TBTF vs. benchmark ETFs (SPY, QQQ, etc.)

4. **Benchmark Comparisons**  

   Pre-2010 Benchmarks:  
   - DJIA  
   - Nasdaq 100 (NDX)  
   - Fama-French portfolios:  
     - ME5 PRIOR4 (Big & High momentum)  
     - ME4 PRIOR3 (Mid & Mid momentum)

   Post-2010 Benchmarks:  
   - DIA (ETF for DJIA)  
   - QQQ (ETF for NDX)  
   - SPY (ETF for S&P500)  
   - VTI (ETF for Total Market)

These comparisons test the criticism that “you can simply buy ETFs.” TBTF aims to demonstrate persistent structural advantage even over low-cost index solutions.

## V. Structural Properties and Regime Shift Analysis

1. **Mixture Distribution Decomposition**  
   - Fit Gaussian Mixture Models (GMM) to TBTF return distributions  
   - Estimate parameters for each period and examine stability over time  
   - Check for shifting weights and volatility asymmetries across components

2. **Quadratic Regression Evolution**  
   - Track changes in $\beta$, $\gamma$ across time  
   - Visualize evolving convexity of capital share by market rank  
   - Increasing convexity may signal growing capital lock-in or reduced competition

3. **Persistence and Lock-in Dynamics**  
   - Measure duration of stay in the top-10 list  
   - Compute entry/exit frequency  
   - Estimate transition matrix (first-order Markov) across three states:
     - Top (e.g., decile 1)
     - Middle (decile 2–9)
     - Out (delisted or not in top-N)

## VI. Robustness and Sensitivity Analysis

1. **Vary Selection Size n**  
   - Evaluate sensitivity to n ∈ {5, 10, 20, 30, 50}

2. **Rebalancing Frequency Sensitivity**  
   - Does monthly rebalancing significantly outperform annual?

3. **Sample Period Robustness**  
   - Conservative evaluation using short in-sample and long out-of-sample periods:
     - In-sample: 1996–1999 → Out-of-sample: 2000–2009  
     - In-sample: 2010–2013 → Out-of-sample: 2014–2023  
   - Extend: 6-year, 8-year in-sample windows  
   - Metrics: Sharpe ratio, drawdown, tail risk, turnover

4. **Alternative Weighting Schemes**  
   - Equal weighting  
   - Cap weighting  
   - Inverse volatility weighting (optional control test)

## VII. Implementation Notes

- Programming: Python (`pandas`, `numpy`, `statsmodels`, `sklearn`, `scipy`)  
- Visualization: `matplotlib`, `seaborn`, `plotly`  
- Notebooks:
  - `01_ff_compare.ipynb`: Fama-French
  - `02_tbtf.ipynb`: Capital lock-in, asymmetric transition, stationary dynamics
    - `data_load`, `portfolio_construct`, `mixture_model`, `transition_analysis`, `visualization`
  - `03_performance_eval.ipynb`: Index and ETF benchmarking, performance metrics
  - `04_robustness_check.ipynb`: Parallelized testing of selection size, frequency, and out-of-sample performance

---

이 내용을 반영하여 `01_ff_compare.ipynb`을 다음의 순서로 재정리할 수 있습니다:

### Suggested Notebook Structure (`01_ff_compare.ipynb`)

1. **Section 1: Data Import**
   - Load `Portfolios_Formed_on_ME` from Ken French Data Library
   - Filter to `s_10`, `b_10`, and optionally aggregate other size portfolios (`s_70`, `s_90`)

2. **Section 2: Descriptive Statistics**
   - Summary stats: mean, std
   - T-test on return differences
   - Net volatility difference between `s_10` and `b_10`

3. **Section 3: Distributional Analysis**
   - QQ-plots of `s_10`, `b_10`
   - Histogram comparison (optional)

4. **Section 4: Sharpe Ratio Dynamics**
   - Compute rolling Sharpe ratio (e.g., 36-month window)
   - Plot level curves for `s_10`, `b_10` over time

5. **Section 5: Interpretation and Export**
   - Summary table
   - Save key plots for inclusion in the TBTF manuscript
