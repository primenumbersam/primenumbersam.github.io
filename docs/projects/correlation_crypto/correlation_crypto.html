<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.6.42">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="gitSAM">
<meta name="dcterms.date" content="2025-03-08">

<title>Correlation within Crypto-currencies – GitSAM</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { display: inline-block; text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
/* CSS for citations */
div.csl-bib-body { }
div.csl-entry {
  clear: both;
  margin-bottom: 0em;
}
.hanging-indent div.csl-entry {
  margin-left:2em;
  text-indent:-2em;
}
div.csl-left-margin {
  min-width:2em;
  float:left;
}
div.csl-right-inline {
  margin-left:2em;
  padding-left:1em;
}
div.csl-indent {
  margin-left: 2em;
}</style>


<script src="../../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../../site_libs/clipboard/clipboard.min.js"></script>
<script src="../../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../../site_libs/quarto-search/fuse.min.js"></script>
<script src="../../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../../">
<script src="../../site_libs/quarto-html/quarto.js"></script>
<script src="../../site_libs/quarto-html/popper.min.js"></script>
<script src="../../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../../site_libs/quarto-html/anchor.min.js"></script>
<link href="../../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../../site_libs/quarto-html/quarto-syntax-highlighting-2f5df379a58b258e96c21c0638c20c03.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="../../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../../site_libs/bootstrap/bootstrap-ddd961a2510921635943dfbbd19534c4.min.css" rel="stylesheet" append-hash="true" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>

  <script src="https://cdnjs.cloudflare.com/polyfill/v3/polyfill.min.js?features=es6"></script>
  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

<script type="text/javascript">
const typesetMath = (el) => {
  if (window.MathJax) {
    // MathJax Typeset
    window.MathJax.typeset([el]);
  } else if (window.katex) {
    // KaTeX Render
    var mathElements = el.getElementsByClassName("math");
    var macros = [];
    for (var i = 0; i < mathElements.length; i++) {
      var texText = mathElements[i].firstChild;
      if (mathElements[i].tagName == "SPAN") {
        window.katex.render(texText.data, mathElements[i], {
          displayMode: mathElements[i].classList.contains('display'),
          throwOnError: false,
          macros: macros,
          fleqn: false
        });
      }
    }
  }
}
window.Quarto = {
  typesetMath
};
</script>

<link rel="stylesheet" href="../../styles.css">
</head>

<body class="nav-fixed">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg " data-bs-theme="dark">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container mx-auto">
    <a class="navbar-brand" href="../../index.html">
    <span class="navbar-title">GitSAM</span>
    </a>
  </div>
            <div id="quarto-search" class="" title="Search"></div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" role="menu" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll me-auto">
  <li class="nav-item">
    <a class="nav-link" href="../../about.html"> 
<span class="menu-text">About</span></a>
  </li>  
  <li class="nav-item dropdown ">
    <a class="nav-link dropdown-toggle" href="#" id="nav-menu-projects" role="link" data-bs-toggle="dropdown" aria-expanded="false">
 <span class="menu-text">Projects</span>
    </a>
    <ul class="dropdown-menu" aria-labelledby="nav-menu-projects">    
        <li>
    <a class="dropdown-item" href="../../projects/correlation_crypto/correlation_crypto.html">
 <span class="dropdown-text">Correlation in Crypto</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../projects/gilded_age/gilded_age.html">
 <span class="dropdown-text">The New Gilded Age</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../projects/pricing_equal/pricing_equal.html">
 <span class="dropdown-text">Pricing Equal Opportunity</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../projects/dichotomy/dichotomy.html">
 <span class="dropdown-text">Distinct Dichotomy</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../projects/pareto_index/pareto_index.html">
 <span class="dropdown-text">Estimating Pareto Index</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../projects/corner_solution/corner_solution.html">
 <span class="dropdown-text">Heading to Corner Solutions</span></a>
  </li>  
    </ul>
  </li>
  <li class="nav-item dropdown ">
    <a class="nav-link dropdown-toggle" href="#" id="nav-menu-time-series" role="link" data-bs-toggle="dropdown" aria-expanded="false">
 <span class="menu-text">Time-series</span>
    </a>
    <ul class="dropdown-menu" aria-labelledby="nav-menu-time-series">    
        <li>
    <a class="dropdown-item" href="../../time-series/labor_decoupling.html">
 <span class="dropdown-text">노동 기여와 분배</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../time-series/indicator_growth.html">
 <span class="dropdown-text">경제성장 지표</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../time-series/joint_covariance_stationary.html">
 <span class="dropdown-text">Stationarity?</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../time-series/tfp.html">
 <span class="dropdown-text">TFP?</span></a>
  </li>  
    </ul>
  </li>
</ul>
          </div> <!-- /navcollapse -->
            <div class="quarto-navbar-tools tools-wide">
    <a href="https://www.gitsam.com" title="" class="quarto-navigation-tool px-1" aria-label=""><i class="bi bi-house"></i></a>
    <a href="https://www.youtube.com/@primenumbersam" title="" class="quarto-navigation-tool px-1" aria-label=""><i class="bi bi-youtube"></i></a>
    <div class="dropdown">
      <a href="" title="" id="quarto-navigation-tool-dropdown-0" class="quarto-navigation-tool dropdown-toggle px-1" data-bs-toggle="dropdown" aria-expanded="false" role="link" aria-label=""><i class="bi bi-github"></i></a>
      <ul class="dropdown-menu" aria-labelledby="quarto-navigation-tool-dropdown-0">
          <li>
            <a class="dropdown-item quarto-navbar-tools-item" href="https://github.com/primenumbersam/primenumbersam.github.io">
            Source Code
            </a>
          </li>
          <li>
            <a class="dropdown-item quarto-navbar-tools-item" href="mailto:primenumbersam@gmail.com">
            Report a Bug
            </a>
          </li>
      </ul>
    </div>
</div>
      </div> <!-- /container-fluid -->
    </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">On this page</h2>
   
  <ul>
  <li><a href="#서론" id="toc-서론" class="nav-link active" data-scroll-target="#서론">서론</a>
  <ul class="collapse">
  <li><a href="#주요-암호화폐-목록-및-카테고리" id="toc-주요-암호화폐-목록-및-카테고리" class="nav-link" data-scroll-target="#주요-암호화폐-목록-및-카테고리">주요 암호화폐 목록 및 카테고리</a></li>
  <li><a href="#암호화폐-관련-정보-제공-매체-리뷰" id="toc-암호화폐-관련-정보-제공-매체-리뷰" class="nav-link" data-scroll-target="#암호화폐-관련-정보-제공-매체-리뷰">암호화폐 관련 정보 제공 매체 리뷰</a></li>
  </ul></li>
  <li><a href="#데이터-분석" id="toc-데이터-분석" class="nav-link" data-scroll-target="#데이터-분석">데이터 분석</a>
  <ul class="collapse">
  <li><a href="#데이터" id="toc-데이터" class="nav-link" data-scroll-target="#데이터">데이터</a></li>
  <li><a href="#분석-방법" id="toc-분석-방법" class="nav-link" data-scroll-target="#분석-방법">분석 방법</a></li>
  </ul></li>
  <li><a href="#토론-discussions" id="toc-토론-discussions" class="nav-link" data-scroll-target="#토론-discussions">토론 (Discussions)</a></li>
  <li><a href="#부록-conditioning-theorems-in-probability-theory" id="toc-부록-conditioning-theorems-in-probability-theory" class="nav-link" data-scroll-target="#부록-conditioning-theorems-in-probability-theory">부록: Conditioning Theorems in Probability Theory</a>
  <ul class="collapse">
  <li><a href="#adams-law-smoothing-property-of-conditional-expectation" id="toc-adams-law-smoothing-property-of-conditional-expectation" class="nav-link" data-scroll-target="#adams-law-smoothing-property-of-conditional-expectation">Adam’s Law: Smoothing Property of Conditional Expectation</a></li>
  <li><a href="#eves-law-variance-decomposition-formula" id="toc-eves-law-variance-decomposition-formula" class="nav-link" data-scroll-target="#eves-law-variance-decomposition-formula">Eve’s Law: Variance Decomposition Formula</a></li>
  <li><a href="#covariance-decomposition-formula" id="toc-covariance-decomposition-formula" class="nav-link" data-scroll-target="#covariance-decomposition-formula">Covariance Decomposition Formula</a></li>
  <li><a href="#bias-variance-decomposition-of-mse" id="toc-bias-variance-decomposition-of-mse" class="nav-link" data-scroll-target="#bias-variance-decomposition-of-mse">Bias-Variance Decomposition of MSE</a></li>
  </ul></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">Correlation within Crypto-currencies</h1>
<p class="subtitle lead">주요 암호화폐 수익률들의 선형 상관계수 분석</p>
</div>



<div class="quarto-title-meta">

    <div>
    <div class="quarto-title-meta-heading">Author</div>
    <div class="quarto-title-meta-contents">
             <p>gitSAM </p>
          </div>
  </div>
    
    <div>
    <div class="quarto-title-meta-heading">Published</div>
    <div class="quarto-title-meta-contents">
      <p class="date">March 8, 2025</p>
    </div>
  </div>
  
    
  </div>
  


</header>


<p>Abstract: 2025년 3월 현재, 시가총액이 크거나 투자자들에게 인기가 많은 주요 암호화폐(popular cryptocurrencies)를 선정하여 지난 1년간의 상관관계를 분석하였다. 대부분의 암호화폐 투자자들은 이러한 주요 암호화폐에 집중적으로 투자하는 경향이 있다. 한편, 암호화폐 자산에 대한 투자자의 평균 투자 기간은 단기(short-term)로, 일반적으로 1개월에서 3개월 사이에 해당한다. 이에 따라 본 연구에서는 데이터의 관측 빈도(observation frequency)를 일간(daily) 단위로 설정하고, 30일, 60일, 90일의 롤링 윈도우(rolling window)를 적용하여 주요 암호화폐 수익률의 선형 상관계수(Pearson’s coefficient)를 분석하였다. 이러한 분석은 변동성 헤징(volatility hedging)을 고려한 분산 투자(diversified investment) 전략 수립에 도움이 될 수 있다. 예를 들어, 일정한 투자 금액(예: 1억 원)을 주요 암호화폐 자산군 내에서 어떻게 배분할지 결정하는 데 있어, 상관계수 분석 결과가 투자 비중 조정에 유용한 정보를 제공할 것으로 기대된다.</p>
<section id="서론" class="level2">
<h2 class="anchored" data-anchor-id="서론">서론</h2>
<p>비트코인(BTC)의 가격 및 수익률은, 단기적으로 다음과 같은 관계를 보여왔다.</p>
<ul>
<li>NDX (나스닥 100 지수)와 강한 양의 상관관계 <span class="citation" data-cites="nasdaq2024 nasdaq2023">(<a href="#ref-nasdaq2024" role="doc-biblioref">Nasdaq 2024</a>, <a href="#ref-nasdaq2023" role="doc-biblioref">2023</a>)</span>,</li>
<li>DXY (미국 달러 지수)와 강한 음의 상관관계 <span class="citation" data-cites="coindesk2023 coinglass2023">(<a href="#ref-coindesk2023" role="doc-biblioref">Coindesk 2023</a>; <a href="#ref-coinglass2023" role="doc-biblioref">Coinglass 2023</a>)</span>. 만약 비트코인 가격이 달러 가격과 장기적으로도 반대 방향으로 움직인다면, 이는 비트코인이 인플레이션 헤지 자산으로 간주될 수도 있을 가능성을 나타낸다 <span class="citation" data-cites="science2021">(<a href="#ref-science2021" role="doc-biblioref">Dyhrberg 2021</a>)</span>.</li>
<li>금 가격 (GOLD), 국내 실질 총생산량 (GDP) 과의 상관관계는 불명확하거나 간접적인 것으로 알려져 있음 <span class="citation" data-cites="cointelegraph2023 cryptoslate2022">(<a href="#ref-cointelegraph2023" role="doc-biblioref">Cointelegraph 2023</a>; <a href="#ref-cryptoslate2022" role="doc-biblioref">Cryptoslate 2022</a>)</span>.</li>
</ul>
<p>역사적 사례</p>
<ul>
<li>2020년 COVID-19 위기 이후 BTC와 NDX의 상관관계가 강화됨 <span class="citation" data-cites="nasdaq2020">(<a href="#ref-nasdaq2020" role="doc-biblioref">Nasdaq 2020</a>)</span>,</li>
<li>2022년 5월 연방준비제도(Fed)의 금리 인상 발표 당시, BTC와 NDX 모두 하락.</li>
<li>2023년 비트코인 빙하기 기간 동안 BTC와 NDX의 상관관계 변화 분석 필요.</li>
<li>2024년 3월 비트코인 ETF가 출시하여 기관 투자자 참여가 증가와 함께께 BTC과 NDX의 coupling이 심해짐.</li>
</ul>
<section id="주요-암호화폐-목록-및-카테고리" class="level3">
<h3 class="anchored" data-anchor-id="주요-암호화폐-목록-및-카테고리">주요 암호화폐 목록 및 카테고리</h3>
<table class="caption-top table">
<colgroup>
<col style="width: 37%">
<col style="width: 21%">
<col style="width: 41%">
</colgroup>
<thead>
<tr class="header">
<th>암호화폐 (Cryptocurrency)</th>
<th>심볼 (Ticker)</th>
<th>카테고리 (Category)</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>비트코인 (Bitcoin)</td>
<td>BTC/USD</td>
<td>Layer 1</td>
</tr>
<tr class="even">
<td>이더리움 (Ethereum)</td>
<td>ETH/USD</td>
<td>Layer 1, Smart Contract</td>
</tr>
<tr class="odd">
<td>테더 (Tether)</td>
<td>USDT/USD</td>
<td>Stablecoin</td>
</tr>
<tr class="even">
<td>리플 (XRP)</td>
<td>XRP/USD</td>
<td>Payment Network</td>
</tr>
<tr class="odd">
<td>솔라나 (Solana)</td>
<td>SOL/USD</td>
<td>Layer 1</td>
</tr>
<tr class="even">
<td>체인링크 (Chainlink)</td>
<td>LINK/USD</td>
<td>Oracle</td>
</tr>
<tr class="odd">
<td>온도 (Ondo)</td>
<td>ONDO/USD</td>
<td>Real-World Asset (RWA)</td>
</tr>
<tr class="even">
<td>카르다노 (Cardano)</td>
<td>ADA/USD</td>
<td>Layer 1</td>
</tr>
<tr class="odd">
<td>트론 (Tron)</td>
<td>TRX/USD</td>
<td>Layer 1</td>
</tr>
<tr class="even">
<td>도지코인 (Dogecoin)</td>
<td>DOGE/USD</td>
<td>Meme Coin</td>
</tr>
</tbody>
</table>
</section>
<section id="암호화폐-관련-정보-제공-매체-리뷰" class="level3">
<h3 class="anchored" data-anchor-id="암호화폐-관련-정보-제공-매체-리뷰">암호화폐 관련 정보 제공 매체 리뷰</h3>
<ul>
<li><strong>시세 데이터 (Price Data):</strong> 실시간 및 과거 가격 변동, 거래량(volume) 등
<ul>
<li><a href="https://coinmarketcap.com/">CoinMarketCap</a></li>
<li><a href="https://www.coingecko.com/">CoinGecko</a></li>
</ul></li>
<li><strong>온체인 데이터 (On-Chain Data):</strong> 거래량, 지갑 주소 변화, 네트워크 활성도 등
<ul>
<li><a href="https://glassnode.com/">Glassnode</a></li>
<li><a href="https://intotheblock.com/">IntoTheBlock</a></li>
</ul></li>
<li><strong>시장 분석 (Market Analysis):</strong> 전문가 및 AI 기반 분석 리포트
<ul>
<li><a href="https://messari.io/">Messari</a></li>
<li><a href="https://cryptoquant.com/">CryptoQuant</a></li>
</ul></li>
<li><strong>뉴스 및 이벤트 (News &amp; Events):</strong> 프로젝트 업데이트, 규제 변화 등
<ul>
<li><a href="https://www.coindesk.com/">CoinDesk</a></li>
<li><a href="https://www.theblock.co/">The Block</a></li>
</ul></li>
<li><strong>소셜 미디어 분석 (Social Media Analysis):</strong> 트위터(X), 레딧(Reddit) 등에서의 커뮤니티 반응
<ul>
<li><a href="https://lunarcrush.com/">LunarCrush</a></li>
<li><a href="https://santiment.net/">Santiment</a></li>
</ul></li>
</ul>
</section>
</section>
<section id="데이터-분석" class="level2">
<h2 class="anchored" data-anchor-id="데이터-분석">데이터 분석</h2>
<section id="데이터" class="level3">
<h3 class="anchored" data-anchor-id="데이터">데이터</h3>
<ul>
<li><strong>데이터 소스:</strong> <a href="https://github.com/ccxt/ccxt">CCXT</a></li>
<li><strong>데이터 기간:</strong> 2024년 3월 1일 - 2025년 2월 28일</li>
<li><strong>데이터 빈도 (Data Frequency):</strong> 일간(Daily)</li>
<li><strong>분석 대상 암호화폐:</strong>
<ul>
<li><code>BTC/USD, ETH/USD, USDT/USD, XRP/USD, SOL/USD, LINK/USD, ONDO/USD, ADA/USD, TRX/USD, DOGE/USD</code></li>
</ul></li>
<li><strong>롤링 윈도우 크기 (Rolling Window Size):</strong> 30일, 60일, 90일</li>
</ul>
</section>
<section id="분석-방법" class="level3">
<h3 class="anchored" data-anchor-id="분석-방법">분석 방법</h3>
<ul>
<li>암호화폐의 <strong>일간 수익률(daily return)</strong>을 계산.</li>
<li>각 롤링 윈도우 크기(30, 60, 90일)에 대해 <strong>롤링 상관 행렬(rolling correlation matrix)</strong>을 계산.</li>
<li>평균 상관계수(mean of rolling correlation matrix)를 도출하여 암호화폐 간의 관계를 분석.</li>
</ul>
<div id="dc7b48e9" class="cell" data-execution_count="1">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="co"># 분석 결과 (Results)</span></span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="co"># 여러 거래소에서 지원하는 거래쌍을 확인</span></span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> ccxt</span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pandas <span class="im">as</span> pd</span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a><span class="co"># 주요 암호화폐 목록</span></span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a>TICKER_COIN <span class="op">=</span> [<span class="st">'BTC/USDT'</span>, <span class="st">'ETH/USDT'</span>, <span class="st">'USDT/USD'</span>, <span class="st">'XRP/USDT'</span>, <span class="st">'SOL/USDT'</span>, <span class="st">'LINK/USDT'</span>, <span class="st">'ONDO/USDT'</span>, <span class="st">'ADA/USDT'</span>, <span class="st">'TRX/USDT'</span>, <span class="st">'DOGE/USDT'</span>]</span>
<span id="cb1-10"><a href="#cb1-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-11"><a href="#cb1-11" aria-hidden="true" tabindex="-1"></a><span class="co"># 지원하는 거래소 목록</span></span>
<span id="cb1-12"><a href="#cb1-12" aria-hidden="true" tabindex="-1"></a>exchanges <span class="op">=</span> [<span class="st">'binance'</span>, <span class="st">'kraken'</span>, <span class="st">'bitfinex'</span>, <span class="st">'poloniex'</span>]</span>
<span id="cb1-13"><a href="#cb1-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-14"><a href="#cb1-14" aria-hidden="true" tabindex="-1"></a><span class="co"># 각 거래소에서 지원하는 거래쌍 확인</span></span>
<span id="cb1-15"><a href="#cb1-15" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> exchange_id <span class="kw">in</span> exchanges:</span>
<span id="cb1-16"><a href="#cb1-16" aria-hidden="true" tabindex="-1"></a>    exchange <span class="op">=</span> <span class="bu">getattr</span>(ccxt, exchange_id)()</span>
<span id="cb1-17"><a href="#cb1-17" aria-hidden="true" tabindex="-1"></a>    markets <span class="op">=</span> exchange.load_markets()</span>
<span id="cb1-18"><a href="#cb1-18" aria-hidden="true" tabindex="-1"></a>    supported_pairs <span class="op">=</span> [pair <span class="cf">for</span> pair <span class="kw">in</span> TICKER_COIN <span class="cf">if</span> pair <span class="kw">in</span> markets]</span>
<span id="cb1-19"><a href="#cb1-19" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f"</span><span class="sc">{</span>exchange_id<span class="sc">}</span><span class="ss"> supports: </span><span class="sc">{</span>supported_pairs<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb1-20"><a href="#cb1-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-21"><a href="#cb1-21" aria-hidden="true" tabindex="-1"></a><span class="co"># 주요 암호화폐 목록</span></span>
<span id="cb1-22"><a href="#cb1-22" aria-hidden="true" tabindex="-1"></a>binance_tickers <span class="op">=</span> [<span class="st">'BTC/USDT'</span>, <span class="st">'ETH/USDT'</span>, <span class="st">'XRP/USDT'</span>, <span class="st">'SOL/USDT'</span>, <span class="st">'LINK/USDT'</span>, <span class="st">'ADA/USDT'</span>, <span class="st">'TRX/USDT'</span>, <span class="st">'DOGE/USDT'</span>]</span>
<span id="cb1-23"><a href="#cb1-23" aria-hidden="true" tabindex="-1"></a>kraken_tickers <span class="op">=</span> [<span class="st">'USDT/USD'</span>]</span>
<span id="cb1-24"><a href="#cb1-24" aria-hidden="true" tabindex="-1"></a>poloniex_tickers <span class="op">=</span> [<span class="st">'ONDO/USDT'</span>]</span>
<span id="cb1-25"><a href="#cb1-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-26"><a href="#cb1-26" aria-hidden="true" tabindex="-1"></a><span class="co"># 데이터 기간 설정</span></span>
<span id="cb1-27"><a href="#cb1-27" aria-hidden="true" tabindex="-1"></a>START_DATE <span class="op">=</span> <span class="st">'2024-03-01'</span></span>
<span id="cb1-28"><a href="#cb1-28" aria-hidden="true" tabindex="-1"></a>END_DATE <span class="op">=</span> <span class="st">'2025-02-28'</span></span>
<span id="cb1-29"><a href="#cb1-29" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-30"><a href="#cb1-30" aria-hidden="true" tabindex="-1"></a><span class="co"># 거래소 설정</span></span>
<span id="cb1-31"><a href="#cb1-31" aria-hidden="true" tabindex="-1"></a>binance <span class="op">=</span> ccxt.binance()</span>
<span id="cb1-32"><a href="#cb1-32" aria-hidden="true" tabindex="-1"></a>kraken <span class="op">=</span> ccxt.kraken()</span>
<span id="cb1-33"><a href="#cb1-33" aria-hidden="true" tabindex="-1"></a>poloniex <span class="op">=</span> ccxt.poloniex()</span>
<span id="cb1-34"><a href="#cb1-34" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-35"><a href="#cb1-35" aria-hidden="true" tabindex="-1"></a><span class="co"># 데이터 불러오기 함수</span></span>
<span id="cb1-36"><a href="#cb1-36" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> fetch_crypto_data(exchange, tickers, start, end):</span>
<span id="cb1-37"><a href="#cb1-37" aria-hidden="true" tabindex="-1"></a>    data <span class="op">=</span> {}</span>
<span id="cb1-38"><a href="#cb1-38" aria-hidden="true" tabindex="-1"></a>    start_timestamp <span class="op">=</span> exchange.parse8601(<span class="ss">f'</span><span class="sc">{</span>start<span class="sc">}</span><span class="ss">T00:00:00Z'</span>)</span>
<span id="cb1-39"><a href="#cb1-39" aria-hidden="true" tabindex="-1"></a>    end_timestamp <span class="op">=</span> exchange.parse8601(<span class="ss">f'</span><span class="sc">{</span>end<span class="sc">}</span><span class="ss">T00:00:00Z'</span>)</span>
<span id="cb1-40"><a href="#cb1-40" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> ticker <span class="kw">in</span> tickers:</span>
<span id="cb1-41"><a href="#cb1-41" aria-hidden="true" tabindex="-1"></a>        <span class="cf">try</span>:</span>
<span id="cb1-42"><a href="#cb1-42" aria-hidden="true" tabindex="-1"></a>            ohlcv <span class="op">=</span> exchange.fetch_ohlcv(ticker, <span class="st">'1d'</span>, since<span class="op">=</span>start_timestamp, limit<span class="op">=</span><span class="dv">1000</span>)</span>
<span id="cb1-43"><a href="#cb1-43" aria-hidden="true" tabindex="-1"></a>            df <span class="op">=</span> pd.DataFrame(ohlcv, columns<span class="op">=</span>[<span class="st">'timestamp'</span>, <span class="st">'open'</span>, <span class="st">'high'</span>, <span class="st">'low'</span>, <span class="st">'close'</span>, <span class="st">'volume'</span>])</span>
<span id="cb1-44"><a href="#cb1-44" aria-hidden="true" tabindex="-1"></a>            df[<span class="st">'timestamp'</span>] <span class="op">=</span> pd.to_datetime(df[<span class="st">'timestamp'</span>], unit<span class="op">=</span><span class="st">'ms'</span>)</span>
<span id="cb1-45"><a href="#cb1-45" aria-hidden="true" tabindex="-1"></a>            df.set_index(<span class="st">'timestamp'</span>, inplace<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb1-46"><a href="#cb1-46" aria-hidden="true" tabindex="-1"></a>            data[ticker] <span class="op">=</span> df[<span class="st">'close'</span>]</span>
<span id="cb1-47"><a href="#cb1-47" aria-hidden="true" tabindex="-1"></a>        <span class="cf">except</span> <span class="pp">Exception</span> <span class="im">as</span> e:</span>
<span id="cb1-48"><a href="#cb1-48" aria-hidden="true" tabindex="-1"></a>            <span class="bu">print</span>(<span class="ss">f"Error fetching </span><span class="sc">{</span>ticker<span class="sc">}</span><span class="ss"> from </span><span class="sc">{</span>exchange<span class="sc">.</span><span class="bu">id</span><span class="sc">}</span><span class="ss">: </span><span class="sc">{</span>e<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb1-49"><a href="#cb1-49" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> pd.DataFrame(data)</span>
<span id="cb1-50"><a href="#cb1-50" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-51"><a href="#cb1-51" aria-hidden="true" tabindex="-1"></a><span class="co"># 데이터 불러오기</span></span>
<span id="cb1-52"><a href="#cb1-52" aria-hidden="true" tabindex="-1"></a>binance_data <span class="op">=</span> fetch_crypto_data(binance, binance_tickers, START_DATE, END_DATE)</span>
<span id="cb1-53"><a href="#cb1-53" aria-hidden="true" tabindex="-1"></a>kraken_data <span class="op">=</span> fetch_crypto_data(kraken, kraken_tickers, START_DATE, END_DATE)</span>
<span id="cb1-54"><a href="#cb1-54" aria-hidden="true" tabindex="-1"></a>poloniex_data <span class="op">=</span> fetch_crypto_data(poloniex, poloniex_tickers, START_DATE, END_DATE)</span>
<span id="cb1-55"><a href="#cb1-55" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-56"><a href="#cb1-56" aria-hidden="true" tabindex="-1"></a><span class="co"># 모든 데이터를 하나의 DataFrame으로 병합</span></span>
<span id="cb1-57"><a href="#cb1-57" aria-hidden="true" tabindex="-1"></a>crypto_prices <span class="op">=</span> pd.concat([binance_data, kraken_data, poloniex_data], axis<span class="op">=</span><span class="dv">1</span>)</span>
<span id="cb1-58"><a href="#cb1-58" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-59"><a href="#cb1-59" aria-hidden="true" tabindex="-1"></a><span class="co"># 1) 일간 수익률 계산</span></span>
<span id="cb1-60"><a href="#cb1-60" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> compute_returns(price_data: pd.DataFrame) <span class="op">-&gt;</span> pd.DataFrame:</span>
<span id="cb1-61"><a href="#cb1-61" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> price_data.pct_change().dropna(how<span class="op">=</span><span class="st">'all'</span>)</span>
<span id="cb1-62"><a href="#cb1-62" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-63"><a href="#cb1-63" aria-hidden="true" tabindex="-1"></a>crypto_returns <span class="op">=</span> compute_returns(crypto_prices)</span>
<span id="cb1-64"><a href="#cb1-64" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-65"><a href="#cb1-65" aria-hidden="true" tabindex="-1"></a><span class="co"># 2) 롤링 상관계수 계산</span></span>
<span id="cb1-66"><a href="#cb1-66" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> rolling_correlation(returns: pd.DataFrame, window: <span class="bu">int</span>) <span class="op">-&gt;</span> pd.DataFrame:</span>
<span id="cb1-67"><a href="#cb1-67" aria-hidden="true" tabindex="-1"></a>    <span class="co">"""</span></span>
<span id="cb1-68"><a href="#cb1-68" aria-hidden="true" tabindex="-1"></a><span class="co">    returns: (date x tickers) DataFrame</span></span>
<span id="cb1-69"><a href="#cb1-69" aria-hidden="true" tabindex="-1"></a><span class="co">    window:  rolling window size (days)</span></span>
<span id="cb1-70"><a href="#cb1-70" aria-hidden="true" tabindex="-1"></a><span class="co">    </span></span>
<span id="cb1-71"><a href="#cb1-71" aria-hidden="true" tabindex="-1"></a><span class="co">    returns.rolling(window).corr() 결과는</span></span>
<span id="cb1-72"><a href="#cb1-72" aria-hidden="true" tabindex="-1"></a><span class="co">      - MultiIndex (date, ticker1)</span></span>
<span id="cb1-73"><a href="#cb1-73" aria-hidden="true" tabindex="-1"></a><span class="co">      - columns = ticker2</span></span>
<span id="cb1-74"><a href="#cb1-74" aria-hidden="true" tabindex="-1"></a><span class="co">    형태를 가집니다.</span></span>
<span id="cb1-75"><a href="#cb1-75" aria-hidden="true" tabindex="-1"></a><span class="co">    """</span></span>
<span id="cb1-76"><a href="#cb1-76" aria-hidden="true" tabindex="-1"></a>    corr_rolling <span class="op">=</span> returns.rolling(window).corr()</span>
<span id="cb1-77"><a href="#cb1-77" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> corr_rolling</span>
<span id="cb1-78"><a href="#cb1-78" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-79"><a href="#cb1-79" aria-hidden="true" tabindex="-1"></a><span class="co"># 3) 날짜별 상관행렬을 모아서 평균 상관행렬을 산출</span></span>
<span id="cb1-80"><a href="#cb1-80" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> average_correlation_matrix(returns: pd.DataFrame, window: <span class="bu">int</span>) <span class="op">-&gt;</span> pd.DataFrame:</span>
<span id="cb1-81"><a href="#cb1-81" aria-hidden="true" tabindex="-1"></a>    <span class="co">"""</span></span>
<span id="cb1-82"><a href="#cb1-82" aria-hidden="true" tabindex="-1"></a><span class="co">    - returns.rolling(window).corr() 결과를 사용</span></span>
<span id="cb1-83"><a href="#cb1-83" aria-hidden="true" tabindex="-1"></a><span class="co">    - 각 날짜별 (티커 x 티커) 상관행렬을 합산 후, 날짜 개수로 나누어 평균</span></span>
<span id="cb1-84"><a href="#cb1-84" aria-hidden="true" tabindex="-1"></a><span class="co">    """</span></span>
<span id="cb1-85"><a href="#cb1-85" aria-hidden="true" tabindex="-1"></a>    corr_rolling <span class="op">=</span> rolling_correlation(returns, window)</span>
<span id="cb1-86"><a href="#cb1-86" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb1-87"><a href="#cb1-87" aria-hidden="true" tabindex="-1"></a>    <span class="co"># MultiIndex에서 날짜(level=0) 목록을 추출</span></span>
<span id="cb1-88"><a href="#cb1-88" aria-hidden="true" tabindex="-1"></a>    unique_dates <span class="op">=</span> corr_rolling.index.get_level_values(<span class="dv">0</span>).unique()</span>
<span id="cb1-89"><a href="#cb1-89" aria-hidden="true" tabindex="-1"></a>    tickers <span class="op">=</span> returns.columns</span>
<span id="cb1-90"><a href="#cb1-90" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb1-91"><a href="#cb1-91" aria-hidden="true" tabindex="-1"></a>    <span class="co"># 상관행렬 누적 합을 위한 (티커 x 티커) 형태의 빈 DataFrame</span></span>
<span id="cb1-92"><a href="#cb1-92" aria-hidden="true" tabindex="-1"></a>    sum_matrix <span class="op">=</span> pd.DataFrame(<span class="fl">0.0</span>, index<span class="op">=</span>tickers, columns<span class="op">=</span>tickers)</span>
<span id="cb1-93"><a href="#cb1-93" aria-hidden="true" tabindex="-1"></a>    count <span class="op">=</span> <span class="dv">0</span></span>
<span id="cb1-94"><a href="#cb1-94" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb1-95"><a href="#cb1-95" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> date <span class="kw">in</span> unique_dates:</span>
<span id="cb1-96"><a href="#cb1-96" aria-hidden="true" tabindex="-1"></a>        <span class="co"># (ticker1 x ticker2) 형태를 얻기 위해 xs(date, level=0)</span></span>
<span id="cb1-97"><a href="#cb1-97" aria-hidden="true" tabindex="-1"></a>        date_corr <span class="op">=</span> corr_rolling.xs(date, level<span class="op">=</span><span class="dv">0</span>)</span>
<span id="cb1-98"><a href="#cb1-98" aria-hidden="true" tabindex="-1"></a>        <span class="co"># date_corr.index = ticker1, date_corr.columns = ticker2</span></span>
<span id="cb1-99"><a href="#cb1-99" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb1-100"><a href="#cb1-100" aria-hidden="true" tabindex="-1"></a>        <span class="co"># 혹시 일부 티커에 대한 데이터가 누락되었을 경우를 대비하여 reindex</span></span>
<span id="cb1-101"><a href="#cb1-101" aria-hidden="true" tabindex="-1"></a>        date_corr <span class="op">=</span> date_corr.reindex(index<span class="op">=</span>tickers, columns<span class="op">=</span>tickers)</span>
<span id="cb1-102"><a href="#cb1-102" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb1-103"><a href="#cb1-103" aria-hidden="true" tabindex="-1"></a>        <span class="co"># 날짜별 상관행렬(N x N)을 모두 누적</span></span>
<span id="cb1-104"><a href="#cb1-104" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> date_corr.notna().<span class="bu">all</span>().<span class="bu">all</span>():</span>
<span id="cb1-105"><a href="#cb1-105" aria-hidden="true" tabindex="-1"></a>            sum_matrix <span class="op">+=</span> date_corr.fillna(<span class="fl">0.0</span>)</span>
<span id="cb1-106"><a href="#cb1-106" aria-hidden="true" tabindex="-1"></a>            count <span class="op">+=</span> <span class="dv">1</span></span>
<span id="cb1-107"><a href="#cb1-107" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb1-108"><a href="#cb1-108" aria-hidden="true" tabindex="-1"></a>    <span class="co"># 평균 계산 (count가 0이 되지 않는다고 가정)</span></span>
<span id="cb1-109"><a href="#cb1-109" aria-hidden="true" tabindex="-1"></a>    mean_matrix <span class="op">=</span> sum_matrix <span class="op">/</span> count</span>
<span id="cb1-110"><a href="#cb1-110" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb1-111"><a href="#cb1-111" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> mean_matrix</span>
<span id="cb1-112"><a href="#cb1-112" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-113"><a href="#cb1-113" aria-hidden="true" tabindex="-1"></a><span class="co"># 4) 롤링 상관계수 평균 계산</span></span>
<span id="cb1-114"><a href="#cb1-114" aria-hidden="true" tabindex="-1"></a>rolling_corr_results <span class="op">=</span> {}</span>
<span id="cb1-115"><a href="#cb1-115" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> window <span class="kw">in</span> [<span class="dv">30</span>, <span class="dv">60</span>, <span class="dv">90</span>]:</span>
<span id="cb1-116"><a href="#cb1-116" aria-hidden="true" tabindex="-1"></a>    mean_corr_matrix <span class="op">=</span> average_correlation_matrix(crypto_returns, window)</span>
<span id="cb1-117"><a href="#cb1-117" aria-hidden="true" tabindex="-1"></a>    rolling_corr_results[window] <span class="op">=</span> mean_corr_matrix</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>binance supports: ['BTC/USDT', 'ETH/USDT', 'XRP/USDT', 'SOL/USDT', 'LINK/USDT', 'ADA/USDT', 'TRX/USDT', 'DOGE/USDT']
kraken supports: ['BTC/USDT', 'ETH/USDT', 'USDT/USD', 'XRP/USDT', 'SOL/USDT', 'LINK/USDT', 'ADA/USDT', 'DOGE/USDT']
bitfinex supports: ['BTC/USDT', 'ETH/USDT', 'USDT/USD', 'XRP/USDT', 'SOL/USDT', 'LINK/USDT', 'ADA/USDT', 'TRX/USDT', 'DOGE/USDT']
poloniex supports: ['BTC/USDT', 'ETH/USDT', 'XRP/USDT', 'SOL/USDT', 'LINK/USDT', 'ONDO/USDT', 'ADA/USDT', 'TRX/USDT', 'DOGE/USDT']</code></pre>
</div>
</div>
<div id="ebe2d2a7" class="cell" data-execution_count="2">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> matplotlib.pyplot <span class="im">as</span> plt</span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> seaborn <span class="im">as</span> sns</span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> numpy <span class="im">as</span> np</span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-5"><a href="#cb3-5" aria-hidden="true" tabindex="-1"></a><span class="co"># 모든 행과 열이 출력되도록 설정</span></span>
<span id="cb3-6"><a href="#cb3-6" aria-hidden="true" tabindex="-1"></a>pd.set_option(<span class="st">'display.max_rows'</span>, <span class="va">None</span>)</span>
<span id="cb3-7"><a href="#cb3-7" aria-hidden="true" tabindex="-1"></a>pd.set_option(<span class="st">'display.max_columns'</span>, <span class="va">None</span>)</span>
<span id="cb3-8"><a href="#cb3-8" aria-hidden="true" tabindex="-1"></a>pd.set_option(<span class="st">'display.width'</span>, <span class="va">None</span>)</span>
<span id="cb3-9"><a href="#cb3-9" aria-hidden="true" tabindex="-1"></a>pd.set_option(<span class="st">'display.expand_frame_repr'</span>, <span class="va">False</span>)</span>
<span id="cb3-10"><a href="#cb3-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-11"><a href="#cb3-11" aria-hidden="true" tabindex="-1"></a><span class="co"># 결과 출력 및 시각화</span></span>
<span id="cb3-12"><a href="#cb3-12" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> window, result <span class="kw">in</span> rolling_corr_results.items():</span>
<span id="cb3-13"><a href="#cb3-13" aria-hidden="true" tabindex="-1"></a>    <span class="co"># 상관 행렬을 DataFrame으로 변환</span></span>
<span id="cb3-14"><a href="#cb3-14" aria-hidden="true" tabindex="-1"></a>    result_df <span class="op">=</span> result.dropna(how<span class="op">=</span><span class="st">'all'</span>)</span>
<span id="cb3-15"><a href="#cb3-15" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f"</span><span class="ch">\n</span><span class="ss">[Window = </span><span class="sc">{</span>window<span class="sc">}</span><span class="ss"> days] Mean Correlation Matrix</span><span class="ch">\n</span><span class="ss">"</span>, result_df)</span>
<span id="cb3-16"><a href="#cb3-16" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb3-17"><a href="#cb3-17" aria-hidden="true" tabindex="-1"></a>    <span class="co"># 히트맵 시각화</span></span>
<span id="cb3-18"><a href="#cb3-18" aria-hidden="true" tabindex="-1"></a>    plt.figure(figsize<span class="op">=</span>(<span class="dv">10</span>, <span class="dv">8</span>))</span>
<span id="cb3-19"><a href="#cb3-19" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb3-20"><a href="#cb3-20" aria-hidden="true" tabindex="-1"></a>    <span class="co"># 대각선 요소를 마스킹</span></span>
<span id="cb3-21"><a href="#cb3-21" aria-hidden="true" tabindex="-1"></a>    mask <span class="op">=</span> np.triu(np.ones(result_df.shape, dtype<span class="op">=</span><span class="bu">bool</span>))</span>
<span id="cb3-22"><a href="#cb3-22" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb3-23"><a href="#cb3-23" aria-hidden="true" tabindex="-1"></a>    sns.heatmap(result_df, annot<span class="op">=</span><span class="va">True</span>, cmap<span class="op">=</span><span class="st">'coolwarm'</span>, center<span class="op">=</span><span class="dv">0</span>, mask<span class="op">=</span>mask)</span>
<span id="cb3-24"><a href="#cb3-24" aria-hidden="true" tabindex="-1"></a>    plt.title(<span class="ss">f'Mean Rolling Correlation Matrix (Window Size: </span><span class="sc">{</span>window<span class="sc">}</span><span class="ss"> days)'</span>)</span>
<span id="cb3-25"><a href="#cb3-25" aria-hidden="true" tabindex="-1"></a>    plt.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>
[Window = 30 days] Mean Correlation Matrix
            BTC/USDT  ETH/USDT  XRP/USDT  SOL/USDT  LINK/USDT  ADA/USDT  TRX/USDT  DOGE/USDT  USDT/USD  ONDO/USDT
BTC/USDT   1.000000  0.797105  0.565396  0.740181   0.681814  0.703330  0.381448   0.811458  0.448836   0.348155
ETH/USDT   0.797105  1.000000  0.554712  0.700525   0.734957  0.717653  0.377615   0.744033  0.281971   0.378042
XRP/USDT   0.565396  0.554712  1.000000  0.548503   0.565133  0.648923  0.314941   0.587624  0.162216   0.226387
SOL/USDT   0.740181  0.700525  0.548503  1.000000   0.670887  0.681714  0.316936   0.691401  0.249393   0.299813
LINK/USDT  0.681814  0.734957  0.565133  0.670887   1.000000  0.757643  0.309796   0.665423  0.229266   0.413496
ADA/USDT   0.703330  0.717653  0.648923  0.681714   0.757643  1.000000  0.413845   0.723846  0.255017   0.327676
TRX/USDT   0.381448  0.377615  0.314941  0.316936   0.309796  0.413845  1.000000   0.366332  0.180630   0.112383
DOGE/USDT  0.811458  0.744033  0.587624  0.691401   0.665423  0.723846  0.366332   1.000000  0.311444   0.345943
USDT/USD   0.448836  0.281971  0.162216  0.249393   0.229266  0.255017  0.180630   0.311444  1.000000   0.239174
ONDO/USDT  0.348155  0.378042  0.226387  0.299813   0.413496  0.327676  0.112383   0.345943  0.239174   1.000000</code></pre>
</div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="correlation_crypto_files/figure-html/cell-3-output-2.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>
[Window = 60 days] Mean Correlation Matrix
            BTC/USDT  ETH/USDT  XRP/USDT  SOL/USDT  LINK/USDT  ADA/USDT  TRX/USDT  DOGE/USDT  USDT/USD  ONDO/USDT
BTC/USDT   1.000000  0.794220  0.512291  0.739069   0.661759  0.686840  0.315186   0.813363  0.439727   0.343463
ETH/USDT   0.794220  1.000000  0.493632  0.686624   0.707773  0.690285  0.302910   0.724075  0.288542   0.368641
XRP/USDT   0.512291  0.493632  1.000000  0.498921   0.533044  0.627304  0.267399   0.535395  0.125375   0.201147
SOL/USDT   0.739069  0.686624  0.498921  1.000000   0.649833  0.665617  0.269850   0.684102  0.234386   0.281717
LINK/USDT  0.661759  0.707773  0.533044  0.649833   1.000000  0.742523  0.253493   0.636039  0.212388   0.396643
ADA/USDT   0.686840  0.690285  0.627304  0.665617   0.742523  1.000000  0.367450   0.707572  0.237446   0.310394
TRX/USDT   0.315186  0.302910  0.267399  0.269850   0.253493  0.367450  1.000000   0.302249  0.151090   0.087379
DOGE/USDT  0.813363  0.724075  0.535395  0.684102   0.636039  0.707572  0.302249   1.000000  0.308611   0.329430
USDT/USD   0.439727  0.288542  0.125375  0.234386   0.212388  0.237446  0.151090   0.308611  1.000000   0.239657
ONDO/USDT  0.343463  0.368641  0.201147  0.281717   0.396643  0.310394  0.087379   0.329430  0.239657   1.000000</code></pre>
</div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="correlation_crypto_files/figure-html/cell-3-output-4.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>
[Window = 90 days] Mean Correlation Matrix
            BTC/USDT  ETH/USDT  XRP/USDT  SOL/USDT  LINK/USDT  ADA/USDT  TRX/USDT  DOGE/USDT  USDT/USD  ONDO/USDT
BTC/USDT   1.000000  0.792785  0.469713  0.741462   0.643975  0.678632  0.265847   0.810099  0.425962   0.341469
ETH/USDT   0.792785  1.000000  0.446246  0.688565   0.694381  0.671355  0.237440   0.706158  0.281146   0.365844
XRP/USDT   0.469713  0.446246  1.000000  0.452216   0.500435  0.606132  0.228845   0.490717  0.097376   0.189752
SOL/USDT   0.741462  0.688565  0.452216  1.000000   0.633733  0.652648  0.246976   0.683199  0.235333   0.277571
LINK/USDT  0.643975  0.694381  0.500435  0.633733   1.000000  0.727257  0.210147   0.608506  0.186046   0.384874
ADA/USDT   0.678632  0.671355  0.606132  0.652648   0.727257  1.000000  0.328959   0.693337  0.222493   0.300068
TRX/USDT   0.265847  0.237440  0.228845  0.246976   0.210147  0.328959  1.000000   0.241866  0.123592   0.078513
DOGE/USDT  0.810099  0.706158  0.490717  0.683199   0.608506  0.693337  0.241866   1.000000  0.296289   0.320651
USDT/USD   0.425962  0.281146  0.097376  0.235333   0.186046  0.222493  0.123592   0.296289  1.000000   0.242642
ONDO/USDT  0.341469  0.365844  0.189752  0.277571   0.384874  0.300068  0.078513   0.320651  0.242642   1.000000</code></pre>
</div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="correlation_crypto_files/figure-html/cell-3-output-6.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
</div>
</section>
</section>
<section id="토론-discussions" class="level2">
<h2 class="anchored" data-anchor-id="토론-discussions">토론 (Discussions)</h2>
<div class="callout callout-style-default callout-important callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Important
</div>
</div>
<div class="callout-body-container callout-body">
<p>변수들의 관찰 주기 (단기? 장기?)에 따라 또는 관찰 시기 (10년전? 지금?)에 따라 변수들 간의 <strong>선형관계</strong>는 유지되지 않을 수 있습니다. 2025년 현재 비트코인 (BTC) 가격은 시장 심리, 규제 변화, 기술적 요인 등에 크게 영향을 받고 있습니다.</p>
</div>
</div>
<ul>
<li>상관계수가 낮은 암호화폐 자산 조합을 식별하고, 헤지 투자 전략을 논의.</li>
<li>특정 암호화폐 간의 높은 상관관계가 나타나는 이유 및 그에 따른 리스크 분석.</li>
</ul>
<p>2024년 3월부터 2025년 2월까지 암호화폐 시장에 큰 영향을 미친 주요 변화 원인과 그 시기:</p>
<ol type="1">
<li><p>비트코인 반감기 (2024년 4월 20일) 비트코인 채굴 보상이 6.25 BTC에서 3.125 BTC로 절반으로 감소했습니다. 이는 비트코인의 공급 감소로 이어져 가격에 상승 압력을 가했습니다.</p></li>
<li><p>비트코인 ETF 자금 유입 증가 (2024년 10월) 비트코인 ETF로의 지속적인 자금 유입이 관찰되었습니다. 10월까지 ETF 투자자들이 총 345,200 BTC(200억 달러 이상의 가치)를 매입했습니다.</p></li>
<li><p>트럼프의 대통령 당선 (2024년 11월) 도널드 트럼프가 “암호화폐 대통령”이 되겠다는 공약을 내세우며 당선되었습니다. 이는 암호화폐 시장에 대한 긍정적인 기대감을 불러일으켰습니다.</p></li>
<li><p>EU의 암호화폐 시장 규제(MiCA) 전면 시행 (2024년 12월 30일) 유럽연합에서 암호화폐 시장 규제(MiCA)가 전면 시행되었습니다. 이로 인해 EU 전역에서 암호화폐 서비스 제공업체들에 대한 통일된 규제 프레임워크가 적용되기 시작했습니다.</p></li>
<li><p>트럼프의 암호화폐 정책 발표 (2025년 1월) 트럼프 대통령이 취임 후 미국을 “암호화폐의 수도”로 만들겠다는 계획을 발표했습니다. 여기에는 비트코인 전략적 비축 등의 아이디어가 포함되었습니다.</p></li>
</ol>
<p>위의 변화와 시기가 stars and bins에서 bins 역할을 한다는 가정하여, 기간 stars는 다음과 같이 나누어 상관관계를 conditional 해 볼 수 있다.</p>
<ol type="1">
<li>20224년 3월 1일 (관측기간 시작일) - 2024년 4월 20일</li>
<li>2024년 4월 21일 - 2024년 9월 30일</li>
<li>2024년 10월 1일 - 2024년 11월 5일</li>
<li>2024년 11월 6일 - 2024년 12월 31일</li>
<li>2025년 1월 1일 - 2025년 2월 28일 (관측기간 종료일)</li>
</ol>
<p>변화를 <span class="math inline">\(Z\)</span>로 표기했다면, covariance decomposition formula에 의해,</p>
</section>
<section id="부록-conditioning-theorems-in-probability-theory" class="level2">
<h2 class="anchored" data-anchor-id="부록-conditioning-theorems-in-probability-theory">부록: Conditioning Theorems in Probability Theory</h2>
<section id="adams-law-smoothing-property-of-conditional-expectation" class="level3">
<h3 class="anchored" data-anchor-id="adams-law-smoothing-property-of-conditional-expectation">Adam’s Law: Smoothing Property of Conditional Expectation</h3>
<p>Also known as the <strong>Law of Total Expectation</strong> or <strong>Law of Iterated Expectations</strong>.</p>
<p>If <span class="math inline">\(X\)</span> is a random variable whose expectation <span class="math inline">\(E(X)\)</span> is defined and <span class="math inline">\(Z\)</span> is any random variable defined on the same probability space, then: <span class="math display">\[E(X) = E(E(X|Z)).\]</span></p>
<p>A conditional expectation can be viewed as a Radon–Nikodym derivative, making the tower property a direct consequence of the chain rule for conditional expectations.</p>
<p>A special discrete case: If <span class="math inline">\(\{Z_{i}\}\)</span> is a finite or countable partition of the sample space, then: <span class="math display">\[E(X) = \sum_{i} E(X \mid Z_i)P(Z_i).\]</span></p>
</section>
<section id="eves-law-variance-decomposition-formula" class="level3">
<h3 class="anchored" data-anchor-id="eves-law-variance-decomposition-formula">Eve’s Law: Variance Decomposition Formula</h3>
<p>Known as the <strong>Conditional Variance Formula</strong> or the <strong>Law of Iterated Variances</strong>.</p>
<p>If <span class="math inline">\(X\)</span> and <span class="math inline">\(Y\)</span> are random variables defined on the same probability space, and if <span class="math inline">\(Y\)</span> has finite variance, then:</p>
<p><span class="math display">\[\operatorname{Var}(Y)=E[\operatorname{Var}(Y\mid X)]+\operatorname{Var}(E[Y\mid X]).\]</span></p>
<p>This is a special case of the covariance decomposition formula.</p>
<p>Applications: Explained by X, on average - 분산 = “(조건부 분산)의 평균” + “(조건부 평균)의 분산”</p>
<ul>
<li><p><strong>Analysis of Variance (ANOVA)</strong>: Variability in <span class="math inline">\(Y\)</span> splits into an “unexplained” within-group variance and an “explained” between-group variance. The F-test examines if the explained variance is significantly large, indicating a meaningful effect of <span class="math inline">\(X\)</span> on <span class="math inline">\(Y\)</span>.</p></li>
<li><p><strong>Linear Regression Models</strong>: The proportion of explained variance is measured as <span class="math inline">\(R^2\)</span>. For simple linear regression (single predictor), <span class="math inline">\(R^2\)</span> equals the squared Pearson correlation coefficient between <span class="math inline">\(X\)</span> and <span class="math inline">\(Y\)</span>.</p></li>
<li><p><strong>Machine Learning and Bayesian Inference</strong>: In many Bayesian and ensemble methods, one decomposes prediction uncertainty via the law of total variance. For a Bayesian neural network with random parameters <span class="math inline">\(\theta\)</span>: <span class="math inline">\(\operatorname {Var} (Y)=\operatorname {E} {\bigl [}\operatorname {Var} (Y\mid \theta ){\bigr ]}+\operatorname {Var} {\bigl (}\operatorname {E} [Y\mid \theta ]{\bigr )}\)</span> often referred to as “aleatoric” (within-model) vs.&nbsp;“epistemic” (between-model) uncertainty</p></li>
<li><p><strong>Information Theory</strong>: For jointly Gaussian <span class="math inline">\((X,Y)\)</span>, the fraction <span class="math inline">\(\operatorname {Var} (\operatorname {E} [Y\mid X])/\operatorname {Var} (Y)\)</span> relates directly to the mutual information <span class="math inline">\(I(Y;X)\)</span>. In non-Gaussian settings, a high explained-variance ratio still indicates significant information about Y contained in X</p></li>
</ul>
<p><strong>Example 1 (Exam Scores)</strong>: Suppose students’ exam scores vary between two classrooms. The variance of all scores (<span class="math inline">\(Y\)</span>) can be decomposed into the variance within classrooms (unexplained) and the variance between classroom averages (explained), reflecting differences in teaching quality or resources.</p>
<p><strong>Example 2 (Mixture of Two Gaussians)</strong>: Consider <span class="math inline">\(Y\)</span> as a mixture of two normal distributions, where the mixing distribution is Bernoulli with parameter <span class="math inline">\(p\)</span>. Suppose:</p>
<p><span class="math display">\[Y \mid (X=0) \sim N(\mu_0, \sigma_0^2), \quad Y \mid (X=1) \sim N(\mu_1, \sigma_1^2).\]</span></p>
<p>Then the law of total variance gives:</p>
<p><span class="math display">\[\operatorname{Var}(Y) = p\sigma_1^2 + (1-p)\sigma_0^2 + p(1-p)(\mu_1 - \mu_0)^2.\]</span></p>
</section>
<section id="covariance-decomposition-formula" class="level3">
<h3 class="anchored" data-anchor-id="covariance-decomposition-formula">Covariance Decomposition Formula</h3>
<p>Known as the <strong>Law of Total Covariance</strong> or <strong>Conditional Covariance Formula</strong>.</p>
<p>If <span class="math inline">\(X\)</span>, <span class="math inline">\(Y\)</span>, and <span class="math inline">\(Z\)</span> are random variables defined on the same probability space, with finite covariance between <span class="math inline">\(X\)</span> and <span class="math inline">\(Y\)</span>, then:</p>
<p><span class="math display">\[\operatorname{cov}(X,Y)=E[\operatorname{cov}(X,Y\mid Z)]+\operatorname{cov}(E[X\mid Z],E[Y\mid Z]).\]</span></p>
<p>This relationship is a particular instance of the general Law of Total Cumulance and is crucial for analyzing dependencies among variables conditioned on a third variable or groupings.</p>
</section>
<section id="bias-variance-decomposition-of-mse" class="level3">




</section>
</section>

<div id="quarto-appendix" class="default"><section class="quarto-appendix-contents" role="doc-bibliography" id="quarto-bibliography"><h2 class="anchored quarto-appendix-heading">Bias-Variance Decomposition of MSE</h2><div id="refs" class="references csl-bib-body hanging-indent" data-entry-spacing="0" role="list">
<div id="ref-coindesk2023" class="csl-entry" role="listitem">
Coindesk. 2023. <span>“Bitcoin’s Negative Correlation with Dollar Index Strengthens Ahead of u.s. GDP Data.”</span> <em>Coindesk Markets</em>. <a href="https://www.coindesk.com/markets/2023/04/27/bitcoins-negative-correlation-with-dollar-index-strengthens-ahead-of-us-gdp">https://www.coindesk.com/markets/2023/04/27/bitcoins-negative-correlation-with-dollar-index-strengthens-ahead-of-us-gdp</a>.
</div>
<div id="ref-coinglass2023" class="csl-entry" role="listitem">
Coinglass. 2023. <span>“The Relationship Between the US Dollar Index (DXY) and Bitcoin Price Volatility.”</span> <em>Coinglass Learn</em>. <a href="https://www.coinglass.com/learn/the-relationship-between-the-us-dollar-index-dxy-and-bitcoin-price-volatility-1">https://www.coinglass.com/learn/the-relationship-between-the-us-dollar-index-dxy-and-bitcoin-price-volatility-1</a>.
</div>
<div id="ref-cointelegraph2023" class="csl-entry" role="listitem">
Cointelegraph. 2023. <span>“Bitcoin and Correlations — Examining the Relationship Between BTC, Gold and the Nasdaq.”</span> <em>Cointelegraph News</em>. <a href="https://cointelegraph.com/news/bitcoin-and-correlations-examining-the-relationship-between-btc-gold-and-the-nasdaq">https://cointelegraph.com/news/bitcoin-and-correlations-examining-the-relationship-between-btc-gold-and-the-nasdaq</a>.
</div>
<div id="ref-cryptoslate2022" class="csl-entry" role="listitem">
Cryptoslate. 2022. <span>“Bitcoin-GDP Correlation May Explain Drop in Price as US Enters a Technical Recession.”</span> <em>Cryptoslate News</em>. <a href="https://cryptoslate.com/bitcoin-gdp-correlation-may-explain-drop-in-price-as-us-enters-a-technical-recession/">https://cryptoslate.com/bitcoin-gdp-correlation-may-explain-drop-in-price-as-us-enters-a-technical-recession/</a>.
</div>
<div id="ref-science2021" class="csl-entry" role="listitem">
Dyhrberg, Anne Haubo. 2021. <span>“Inflation and Bitcoin: A Descriptive Time-Series Analysis.”</span> <em>Economics Letters</em> 204. <a href="https://doi.org/10.1016/j.econlet.2021.109875">https://doi.org/10.1016/j.econlet.2021.109875</a>.
</div>
<div id="ref-nasdaq2020" class="csl-entry" role="listitem">
Nasdaq. 2020. <span>“Study Shows Recent Correlation Between Bitcoin and Stocks Is Temporary.”</span> <em>Nasdaq Articles</em>. <a href="https://www.nasdaq.com/articles/study-shows-recent-correlation-between-bitcoin-and-stocks-is-temporary">https://www.nasdaq.com/articles/study-shows-recent-correlation-between-bitcoin-and-stocks-is-temporary</a>.
</div>
<div id="ref-nasdaq2023" class="csl-entry" role="listitem">
———. 2023. <span>“Understanding Bitcoin, Nasdaq-100 Correlations.”</span> <em>Nasdaq Articles</em>. <a href="https://www.nasdaq.com/articles/understanding-bitcoin-nasdaq-100-correlations">https://www.nasdaq.com/articles/understanding-bitcoin-nasdaq-100-correlations</a>.
</div>
<div id="ref-nasdaq2024" class="csl-entry" role="listitem">
———. 2024. <span>“Bitcoin’s Correlation to Equities Is Rising.”</span> <em>Nasdaq Articles</em>. <a href="https://www.nasdaq.com/articles/bitcoins-correlation-to-equities-is-rising">https://www.nasdaq.com/articles/bitcoins-correlation-to-equities-is-rising</a>.
</div>
</div></section></div></main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const onCopySuccess = function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  }
  const getTextToCopy = function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
    text: getTextToCopy
  });
  clipboard.on('success', onCopySuccess);
  if (window.document.getElementById('quarto-embedded-source-code-modal')) {
    const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
      text: getTextToCopy,
      container: window.document.getElementById('quarto-embedded-source-code-modal')
    });
    clipboardModal.on('success', onCopySuccess);
  }
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp('/' + window.location.host + '/');
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      if (note) {
        return note.innerHTML;
      } else {
        return "";
      }
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->




</body></html>